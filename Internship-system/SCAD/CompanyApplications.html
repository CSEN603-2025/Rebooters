<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Applications | SCAD System</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Enhanced filter controls styling */
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .search-group {
            position: relative;
            flex-grow: 1;
            max-width: 300px;
        }
        .search-group input {
            padding-left: 35px;
        }
        .search-group i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filter-group label {
            margin-bottom: 0;
            white-space: nowrap;
        }
        
        /* Enhanced action buttons */
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        /* Modal enhancements */
        .modal-content.large {
            max-width: 800px;
        }
        .company-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .detail-row {
            margin-bottom: 10px;
        }
        .detail-label {
            font-weight: 600;
            color: #495057;
        }
        .documents-section {
            margin-top: 20px;
        }
        .document-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <img src="../../assets/images/guc-logo.png" alt="SCAD Logo" class="logo">
                <span class="system-name">Company Applications</span>
            </div>
            <div class="nav-menu">
                <a href="notifications.html" class="nav-link"><i class="fas fa-bell"></i><span class="notification-badge">5</span></a>
                <a href="#" class="nav-link logout-btn"><i class="fas fa-sign-out-alt"></i></a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="user-profile">
                <img src="../../assets/images/guc-logo.png" alt="Admin Avatar" class="avatar">
                <div class="profile-status">
                    <span class="status-badge admin">SCAD Office</span>
                </div>
                <h3>Admin User</h3>
                <p>System Administrator</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="companies.html" class="active"><i class="fas fa-building"></i> Company Applications</a></li>
                    <li><a href="students.html"><i class="fas fa-users"></i> Student Management</a></li>
                    <li><a href="reports.html"><i class="fas fa-file-alt"></i> Internship Reports</a></li>
                    <li><a href="cycles.html"><i class="fas fa-calendar-alt"></i> Internship Cycles</a></li>
                    <li><a href="statistics.html"><i class="fas fa-chart-bar"></i> System Statistics</a></li>
                    <li><a href="workshops.html"><i class="fas fa-chalkboard-teacher"></i> Workshops</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="dashboard-header">
                <h1>Company Applications</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="export-btn"><i class="fas fa-download"></i> Export</button>
                </div>
            </div>

            <!-- Search and Filter Controls -->
            <div class="filter-controls">
                <div class="search-group">
                    <i class="fas fa-search"></i>
                    <input type="text" id="company-search" class="form-control" placeholder="Search by company name...">
                </div>
                
                <div class="filter-group">
                    <label for="status-filter">Status:</label>
                    <select id="status-filter" class="form-control">
                        <option value="all">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="industry-filter">Industry:</label>
                    <select id="industry-filter" class="form-control">
                        <option value="all">All Industries</option>
                        <option value="Software Development">Software Development</option>
                        <option value="Renewable Energy">Renewable Energy</option>
                        <option value="Data Science">Data Science</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Finance">Finance</option>
                        <option value="Education">Education</option>
                    </select>
                </div>
                
                <button class="btn btn-secondary" id="reset-filters">
                    <i class="fas fa-undo"></i> Reset
                </button>
            </div>

            <div class="dashboard-section">
                <div class="table-responsive">
                    <table class="companies-table" id="companies-table">
                        <thead>
                            <tr>
                                <th>Company Name</th>
                                <th>Industry</th>
                                <th>Size</th>
                                <th>Contact Email</th>
                                <th>Applied On</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-id="1" data-status="pending" data-industry="Software Development">
                                <td>Tech Innovations LLC</td>
                                <td>Software Development</td>
                                <td>Medium</td>
                                <td>contact@techinnovations.com</td>
                                <td>2023-10-10</td>
                                <td><span class="status-badge pending">Pending</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-primary btn-review">Review</button>
                                        <button class="btn btn-sm btn-secondary btn-view-details">Details</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-id="2" data-status="pending" data-industry="Renewable Energy">
                                <td>Green Energy Solutions</td>
                                <td>Renewable Energy</td>
                                <td>Large</td>
                                <td>info@greenenergy.com</td>
                                <td>2023-10-08</td>
                                <td><span class="status-badge pending">Pending</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-primary btn-review">Review</button>
                                        <button class="btn btn-sm btn-secondary btn-view-details">Details</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-id="3" data-status="approved" data-industry="Data Science">
                                <td>Data Analytics Pro</td>
                                <td>Data Science</td>
                                <td>Small</td>
                                <td>hr@dataanalytics.com</td>
                                <td>2023-10-05</td>
                                <td><span class="status-badge approved">Approved</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-secondary btn-view-details">Details</button>
                                        <button class="btn btn-sm btn-danger btn-reject">Revoke</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-id="4" data-status="rejected" data-industry="Healthcare">
                                <td>MediCare Solutions</td>
                                <td>Healthcare</td>
                                <td>Large</td>
                                <td>internships@medicare.com</td>
                                <td>2023-09-28</td>
                                <td><span class="status-badge rejected">Rejected</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-secondary btn-view-details">Details</button>
                                        <button class="btn btn-sm btn-success btn-approve">Reconsider</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination">
                    <button class="btn btn-secondary" disabled>Previous</button>
                    <span class="page-info">Page 1 of 2</span>
                    <button class="btn btn-secondary">Next</button>
                </div>
            </div>

            <!-- Company Details Modal -->
            <div class="modal" id="company-details-modal">
                <div class="modal-content large">
                    <div class="modal-header">
                        <h3 id="modal-company-name">Company Details</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="company-details-grid">
                            <div class="company-info">
                                <h4>Basic Information</h4>
                                <div class="detail-row">
                                    <span class="detail-label">Company Name:</span>
                                    <span class="detail-value" id="detail-company-name">Tech Innovations LLC</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Industry:</span>
                                    <span class="detail-value" id="detail-industry">Software Development</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Company Size:</span>
                                    <span class="detail-value" id="detail-size">Medium (50-200 employees)</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Website:</span>
                                    <span class="detail-value" id="detail-website">www.techinnovations.com</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Founded:</span>
                                    <span class="detail-value" id="detail-founded">2015</span>
                                </div>
                            </div>
                            
                            <div class="contact-info">
                                <h4>Contact Information</h4>
                                <div class="detail-row">
                                    <span class="detail-label">Contact Person:</span>
                                    <span class="detail-value" id="detail-contact-person">Sarah Johnson</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Position:</span>
                                    <span class="detail-value" id="detail-position">HR Manager</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Email:</span>
                                    <span class="detail-value" id="detail-email">sarah.johnson@techinnovations.com</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Phone:</span>
                                    <span class="detail-value" id="detail-phone">+1 (555) 123-4567</span>
                                </div>
                            </div>
                            
                            <div class="internship-info">
                                <h4>Internship Details</h4>
                                <div class="detail-row">
                                    <span class="detail-label">Positions Offered:</span>
                                    <span class="detail-value" id="detail-positions">5</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Internship Duration:</span>
                                    <span class="detail-value" id="detail-duration">3 months</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Stipend:</span>
                                    <span class="detail-value" id="detail-stipend">$800/month</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Areas:</span>
                                    <span class="detail-value" id="detail-areas">Web Development, Mobile Development, Data Science</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="documents-section">
                            <h4>Attached Documents</h4>
                            <div class="document-list">
                                <div class="document-item">
                                    <i class="fas fa-file-pdf"></i>
                                    <span>Company_Registration.pdf</span>
                                    <button class="btn btn-sm btn-secondary">Download</button>
                                </div>
                                <div class="document-item">
                                    <i class="fas fa-file-word"></i>
                                    <span>Internship_Program.docx</span>
                                    <button class="btn btn-sm btn-secondary">Download</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="status-section">
                            <h4>Application Status</h4>
                            <div class="status-actions">
                                <div class="current-status">
                                    <span>Current Status:</span>
                                    <span class="status-badge pending" id="current-status-badge">Pending</span>
                                </div>
                                <div class="status-buttons">
                                    <button class="btn btn-success" id="btn-approve">Approve</button>
                                    <button class="btn btn-danger" id="btn-reject">Reject</button>
                                    <button class="btn btn-secondary" id="btn-request-info">Request More Info</button>
                                </div>
                            </div>
                            <div class="status-notes">
                                <label for="status-notes">Notes:</label>
                                <textarea id="status-notes" rows="3" placeholder="Add any notes about this application..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-modal">Close</button>
                        <button class="btn btn-primary" id="btn-save-changes">Save Changes</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const searchInput = document.getElementById('company-search');
            const statusFilter = document.getElementById('status-filter');
            const industryFilter = document.getElementById('industry-filter');
            const resetBtn = document.getElementById('reset-filters');
            const companiesTable = document.getElementById('companies-table');
            const rows = companiesTable.querySelectorAll('tbody tr');
            
            // Modal Elements
            const modal = document.getElementById('company-details-modal');
            const closeModalBtns = document.querySelectorAll('.close-modal');
            const viewDetailBtns = document.querySelectorAll('.btn-view-details');
            const reviewBtns = document.querySelectorAll('.btn-review');
            const approveBtns = document.querySelectorAll('.btn-approve');
            const rejectBtns = document.querySelectorAll('.btn-reject');
            
            // Sample company data (in a real app, this would come from your backend)
            const companiesData = {
                1: {
                    name: "Tech Innovations LLC",
                    industry: "Software Development",
                    size: "Medium (50-200 employees)",
                    website: "www.techinnovations.com",
                    founded: "2015",
                    contactPerson: "Sarah Johnson",
                    position: "HR Manager",
                    email: "sarah.johnson@techinnovations.com",
                    phone: "+1 (555) 123-4567",
                    positions: "5",
                    duration: "3 months",
                    stipend: "$800/month",
                    areas: "Web Development, Mobile Development, Data Science",
                    status: "pending",
                    documents: [
                        { name: "Company_Registration.pdf", type: "pdf" },
                        { name: "Internship_Program.docx", type: "word" }
                    ],
                    notes: ""
                },
                2: {
                    name: "Green Energy Solutions",
                    industry: "Renewable Energy",
                    size: "Large (500+ employees)",
                    website: "www.greenenergy.com",
                    founded: "2010",
                    contactPerson: "Michael Brown",
                    position: "Director of Talent",
                    email: "michael.brown@greenenergy.com",
                    phone: "+1 (555) 987-6543",
                    positions: "8",
                    duration: "4 months",
                    stipend: "$1,000/month",
                    areas: "Engineering, Environmental Science",
                    status: "pending",
                    documents: [
                        { name: "Business_License.pdf", type: "pdf" },
                        { name: "Internship_Description.docx", type: "word" }
                    ],
                    notes: ""
                }
            };
            
            // Current company being viewed in modal
            let currentCompanyId = null;
            
            // Filter companies based on search and filters
            function filterCompanies() {
                const searchTerm = searchInput.value.toLowerCase();
                const statusValue = statusFilter.value;
                const industryValue = industryFilter.value;
                
                rows.forEach(row => {
                    const companyName = row.cells[0].textContent.toLowerCase();
                    const status = row.getAttribute('data-status');
                    const industry = row.getAttribute('data-industry');
                    
                    const matchesSearch = companyName.includes(searchTerm);
                    const matchesStatus = statusValue === 'all' || status === statusValue;
                    const matchesIndustry = industryValue === 'all' || industry === industryValue;
                    
                    if (matchesSearch && matchesStatus && matchesIndustry) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
            
            // Load company data into modal
            function loadCompanyDetails(companyId) {
                const company = companiesData[companyId];
                if (!company) return;
                
                currentCompanyId = companyId;
                
                // Update modal title
                document.getElementById('modal-company-name').textContent = `${company.name} - Details`;
                
                // Update basic info
                document.getElementById('detail-company-name').textContent = company.name;
                document.getElementById('detail-industry').textContent = company.industry;
                document.getElementById('detail-size').textContent = company.size;
                document.getElementById('detail-website').textContent = company.website;
                document.getElementById('detail-founded').textContent = company.founded;
                
                // Update contact info
                document.getElementById('detail-contact-person').textContent = company.contactPerson;
                document.getElementById('detail-position').textContent = company.position;
                document.getElementById('detail-email').textContent = company.email;
                document.getElementById('detail-phone').textContent = company.phone;
                
                // Update internship info
                document.getElementById('detail-positions').textContent = company.positions;
                document.getElementById('detail-duration').textContent = company.duration;
                document.getElementById('detail-stipend').textContent = company.stipend;
                document.getElementById('detail-areas').textContent = company.areas;
                
                // Update status
                const statusBadge = document.getElementById('current-status-badge');
                statusBadge.textContent = company.status.charAt(0).toUpperCase() + company.status.slice(1);
                statusBadge.className = 'status-badge ' + company.status;
                
                // Update notes
                document.getElementById('status-notes').value = company.notes;
                
                // Update documents list
                const documentsList = document.querySelector('.document-list');
                documentsList.innerHTML = '';
                company.documents.forEach(doc => {
                    const iconClass = doc.type === 'pdf' ? 'fa-file-pdf' : 'fa-file-word';
                    const docItem = document.createElement('div');
                    docItem.className = 'document-item';
                    docItem.innerHTML = `
                        <i class="fas ${iconClass}"></i>
                        <span>${doc.name}</span>
                        <button class="btn btn-sm btn-secondary">Download</button>
                    `;
                    documentsList.appendChild(docItem);
                });
            }
            
            // Update company status
            function updateCompanyStatus(companyId, newStatus) {
                const company = companiesData[companyId];
                if (!company) return;
                
                company.status = newStatus;
                
                // Update the table row
                const row = document.querySelector(`tr[data-id="${companyId}"]`);
                if (row) {
                    row.setAttribute('data-status', newStatus);
                    const statusBadge = row.querySelector('.status-badge');
                    statusBadge.textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
                    statusBadge.className = 'status-badge ' + newStatus;
                    
                    // Update action buttons based on new status
                    const actionCell = row.cells[6];
                    if (newStatus === 'approved') {
                        actionCell.innerHTML = `
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-secondary btn-view-details">Details</button>
                                <button class="btn btn-sm btn-danger btn-reject">Revoke</button>
                            </div>
                        `;
                    } else if (newStatus === 'rejected') {
                        actionCell.innerHTML = `
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-secondary btn-view-details">Details</button>
                                <button class="btn btn-sm btn-success btn-approve">Reconsider</button>
                            </div>
                        `;
                    }
                    
                    // Reattach event listeners to new buttons
                    const newViewBtn = actionCell.querySelector('.btn-view-details');
                    const newActionBtn = actionCell.querySelector(newStatus === 'approved' ? '.btn-reject' : '.btn-approve');
                    
                    if (newViewBtn) {
                        newViewBtn.addEventListener('click', () => {
                            loadCompanyDetails(companyId);
                            modal.style.display = 'flex';
                        });
                    }
                    
                    if (newActionBtn) {
                        newActionBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const reverseStatus = newStatus === 'approved' ? 'rejected' : 'approved';
                            updateCompanyStatus(companyId, reverseStatus);
                        });
                    }
                }
                
                // If modal is open for this company, update it
                if (currentCompanyId === companyId) {
                    loadCompanyDetails(companyId);
                }
            }
            
            // Event listeners for filters
            searchInput.addEventListener('input', filterCompanies);
            statusFilter.addEventListener('change', filterCompanies);
            industryFilter.addEventListener('change', filterCompanies);
            
            // Reset all filters
            resetBtn.addEventListener('click', function() {
                searchInput.value = '';
                statusFilter.value = 'all';
                industryFilter.value = 'all';
                filterCompanies();
            });
            
            // Modal functionality
            viewDetailBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const companyId = this.closest('tr').getAttribute('data-id');
                    loadCompanyDetails(companyId);
                    modal.style.display = 'flex';
                });
            });
            
            reviewBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const companyId = this.closest('tr').getAttribute('data-id');
                    loadCompanyDetails(companyId);
                    modal.style.display = 'flex';
                });
            });
            
            // Approve/Reject buttons in table
            approveBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const companyId = this.closest('tr').getAttribute('data-id');
                    updateCompanyStatus(companyId, 'approved');
                });
            });
            
            rejectBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const companyId = this.closest('tr').getAttribute('data-id');
                    updateCompanyStatus(companyId, 'rejected');
                });
            });
            
            // Modal buttons
            document.getElementById('btn-approve').addEventListener('click', function() {
                if (currentCompanyId) {
                    updateCompanyStatus(currentCompanyId, 'approved');
                }
            });
            
            document.getElementById('btn-reject').addEventListener('click', function() {
                if (currentCompanyId) {
                    updateCompanyStatus(currentCompanyId, 'rejected');
                }
            });
            
            document.getElementById('btn-save-changes').addEventListener('click', function() {
                if (currentCompanyId) {
                    // Save notes
                    companiesData[currentCompanyId].notes = document.getElementById('status-notes').value;
                    // Close modal
                    modal.style.display = 'none';
                    // Show success message (you would implement this)
                    alert('Changes saved successfully!');
                }
            });
            
            // Close modal
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Initial filter
            filterCompanies();
        });
    </script>
    <script src="../../assets/js/auth.js"></script>
</body>
</html>